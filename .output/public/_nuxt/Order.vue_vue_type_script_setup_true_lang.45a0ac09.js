import{_ as K}from"./Title.vue_vue_type_script_setup_true_lang.be9391ed.js";import Q from"./Content.44c60870.js";import{_ as W}from"./DetailModal.vue_vue_type_script_setup_true_lang.03996a47.js";import{_ as X}from"./Button.vue_vue_type_script_setup_true_lang.4815a5e4.js";import{_ as Z}from"./index.vue_vue_type_script_setup_true_lang.77ac5100.js";import{_ as I}from"./Modal.vue_vue_type_script_setup_true_lang.f5b130c5.js";import{o as d,b as m,p as c,a as ee,a9 as se,ah as te,f as _,ab as b,k as ne,af as oe,l as s,m as l,u as B,$ as ae,c as j,S as P,aj as S,y as le,ac as ce}from"./entry.fd4c3c58.js";import{u as ie}from"./useSocket.263359d4.js";import{_ as re}from"./list.4dce8f16.js";import{A as de}from"./index.091769df.js";import{_ as L}from"./Table.vue_vue_type_script_setup_true_lang.d5a03b9c.js";const ue={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 1216 1312",width:"1.2em",height:"1.2em"},_e=c("path",{fill:"currentColor",d:"M1202 1066q0 40-28 68l-136 136q-28 28-68 28t-68-28L608 976l-294 294q-28 28-68 28t-68-28L42 1134q-28-28-28-68t28-68l294-294L42 410q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 294l294-294q28-28 68-28t68 28l136 136q28 28 28 68t-28 68L880 704l294 294q28 28 28 68z"},null,-1),me=[_e];function fe(w,k){return d(),m("svg",ue,me)}const pe={name:"fa-times",render:fe},ve={preserveAspectRatio:"xMidYMid meet",viewBox:"0 0 1600 1280",width:"1.2em",height:"1.2em"},he=c("path",{fill:"currentColor",d:"M1575 310q0 40-28 68l-724 724l-136 136q-28 28-68 28t-68-28l-136-136L53 740q-28-28-28-68t28-68l136-136q28-28 68-28t68 28l294 295l656-657q28-28 68-28t68 28l136 136q28 28 28 68z"},null,-1),xe=[he];function ke(w,k){return d(),m("svg",ve,xe)}const ye={name:"fa-check",render:ke},Ce={class:"flex-1 flex"},ge=c("span",{class:"ml-2"},"See Detail",-1),$e=c("span",{class:"ml-2"},"Process",-1),be=c("span",{class:"ml-2"},"Decline",-1),we={class:"flex-1 flex"},Te=c("span",{class:"ml-2"},"See Detail",-1),ze=c("span",{class:"ml-2"},"Finish",-1),qe=c("span",{class:"ml-2"},"Cancel",-1),Me={class:"mt-2"},Ne=P(" Are you sure want to "),Ae={key:0},Be={key:1},je={key:2},Se={key:3},Le=P(" this order ? "),Pe={class:"flex justify-end space-x-4 mt-4"},Ke=ee({__name:"Order",setup(w){const k=se(),T=te(),D=ce(),{socket:z}=ie(),y=_(null),F=b.Transaction.All({filter:{status:"pending"}}),O=_([{key:"no",label:"No",data:"$index"},{key:"code",label:"Transaction Code",data:"code"},{key:"name",label:"Name",data:"user_name"},{key:"total",label:"Total",builder:e=>S(e.total||"")},{key:"action",label:"..."}]),C=_(null),V=b.Transaction.All({filter:{status:"processing"}}),E=_([{key:"no",label:"No",data:"$index"},{key:"code",label:"Transaction Code",data:"code"},{key:"name",label:"Name",data:"user_name"},{key:"total",label:"Total",builder:e=>S(e.total||"")},{key:"status",label:"Status",data:"status"},{key:"action",label:"..."}]),a=_(),g=_(!1),o=_("decline"),u=e=>{g.value=!g.value,o.value=e||o.value},q=e=>{console.log("detail",e),a.value=e,o.value="detail"},R=e=>{console.log("process",e),a.value=e,u("process")},U=e=>{console.log("decline",e),a.value=e,u("decline")},Y=e=>{console.log("cancel",e),a.value=e,u("cancel")},G=e=>{console.log("finish",e),a.value=e,u("finish")},M=async()=>{var f,p,v,h;const e=o.value,n=a.value;if(!!n){k.show(),await new Promise(t=>setTimeout(t,1e3));try{if(["process","cancel","decline","finish"].includes(e)){let t="pending",r="";e==="process"?(t="processing",r=`Transaction ${n.code} has been processed`):e==="cancel"?(t="pending",r=`Transaction ${n.code} process has been canceled`):e==="decline"?(t="declined",r=`Transaction ${n.code} has been declined`):e==="finish"&&(t="finished",r=`Transaction ${n.code} has been finished`),(await D.create(b.Transaction.Update(n.id,{status:t}))).status===200&&T.success(r)}}catch(t){if(t instanceof de){const r=((p=(f=t.response)==null?void 0:f.data)==null?void 0:p.message)||"Something went wrong";T.error(r)}}u(o.value),k.hide(),(v=y.value)==null||v.fetch(),(h=C.value)==null||h.fetch()}},N=()=>{var e,n;(e=y.value)==null||e.fetch(),(n=C.value)==null||n.fetch()};return ne(()=>{var e;(e=z.value)==null||e.on("new:order",N)}),oe(()=>{var e;(e=z.value)==null||e.off("new:order",N)}),(e,n)=>{const f=K,p=Q,v=W,h=re,t=X,r=ye,$=pe,A=Z,H=I,J=le;return d(),m("div",null,[s(A,{class:"mb-4"},{default:l(()=>[s(p,{class:"pb-2"},{default:l(()=>[s(f,{class:"capitalize",text:"New Order"})]),_:1}),s(L,{ref_key:"table1",ref:y,columns:O.value,api:B(F)},{"row-col-action":l(({rawItem:i})=>[s(v,{show:!!(a.value&&o.value==="detail"&&a.value.id===i.id),transaction:a.value,onClose:n[0]||(n[0]=()=>{a.value=void 0})},null,8,["show","transaction"]),c("div",Ce,[s(t,{class:"mr-2 flex items-center justify-center",size:"xs",type:"secondary",onClick:x=>q(i)},{default:l(()=>[s(h,{class:"text-xs"}),ge]),_:2},1032,["onClick"]),s(t,{class:"mr-2 flex items-center justify-center",size:"xs",onClick:x=>R(i)},{default:l(()=>[s(r,{class:"text-xs"}),$e]),_:2},1032,["onClick"]),s(t,{class:"mr-2 flex items-center justify-center",size:"xs",type:"danger",onClick:x=>U(i)},{default:l(()=>[s($,{class:"text-xs"}),be]),_:2},1032,["onClick"])])]),_:1},8,["columns","api"])]),_:1}),s(A,{class:"mb-4"},{default:l(()=>[s(p,{class:"pb-2"},{default:l(()=>[s(f,{class:"capitalize",text:"Processing Order"})]),_:1}),s(L,{ref_key:"table2",ref:C,columns:E.value,api:B(V)},{"row-col-action":l(({rawItem:i})=>[s(v,{show:!!(a.value&&o.value==="detail"&&a.value.id===i.id),transaction:a.value,onClose:n[1]||(n[1]=()=>{a.value=void 0})},null,8,["show","transaction"]),c("div",we,[s(t,{class:"mr-2 flex items-center justify-center",size:"xs",type:"secondary",onClick:x=>q(i)},{default:l(()=>[s(h,{class:"text-xs"}),Te]),_:2},1032,["onClick"]),s(t,{class:"mr-2 flex items-center justify-center",size:"xs",onClick:x=>G(i)},{default:l(()=>[s(r,{class:"text-xs"}),ze]),_:2},1032,["onClick"]),s(t,{class:"mr-2 flex items-center justify-center",size:"xs",type:"danger",onClick:x=>Y(i)},{default:l(()=>[s($,{class:"text-xs"}),qe]),_:2},1032,["onClick"])])]),_:1},8,["columns","api"])]),_:1}),s(J,null,{default:l(()=>[s(H,{title:"Confirm",show:g.value,onClose:n[3]||(n[3]=i=>u(o.value))},{default:l(()=>[c("div",Me,[c("p",null,[Ne,o.value==="decline"?(d(),m("span",Ae,"Decline")):o.value==="cancel"?(d(),m("span",Be,"Cancel Processing")):o.value==="finish"?(d(),m("span",je,"Finish Processing")):o.value==="process"?(d(),m("span",Se,"Process")):ae("",!0),Le])]),c("div",Pe,[s(t,{class:"capitalize",size:"sm",type:"opposite",text:"Back",onClick:n[2]||(n[2]=i=>u(o.value))}),["decline","cancel"].includes(o.value)?(d(),j(t,{key:0,class:"capitalize",size:"sm",type:"danger",text:o.value,onClick:M},null,8,["text"])):(d(),j(t,{key:1,class:"capitalize",size:"sm",type:"primary",text:o.value,onClick:M},null,8,["text"]))])]),_:1},8,["show"])]),_:1})])}}});export{Ke as _};
